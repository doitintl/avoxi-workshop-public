import {
  __async,
  __spreadProps,
  __spreadValues
} from "../chunk-WFI2LP4G.mjs";
import { Document, DocumentDataSchema } from "@genkit-ai/ai/retriever";
const getFirestoreDocumentRetriever = (db, collectionName) => {
  const firestoreRetriever = (neighbors) => __async(void 0, null, function* () {
    var _a;
    const docs = [];
    for (const neighbor of neighbors) {
      const docRef = db.collection(collectionName).doc((_a = neighbor.datapoint) == null ? void 0 : _a.datapointId);
      const docSnapshot = yield docRef.get();
      if (docSnapshot.exists) {
        const docData = __spreadProps(__spreadValues({}, docSnapshot.data()), { metadata: __spreadValues({}, neighbor) });
        const parsedDocData = DocumentDataSchema.safeParse(docData);
        if (parsedDocData.success) {
          docs.push(new Document(parsedDocData.data));
        }
      }
    }
    return docs;
  });
  return firestoreRetriever;
};
const getFirestoreDocumentIndexer = (db, collectionName) => {
  const firestoreIndexer = (docs) => __async(void 0, null, function* () {
    const batch = db.batch();
    const ids = [];
    docs.forEach((doc) => {
      const docRef = db.collection(collectionName).doc();
      batch.set(docRef, {
        content: doc.content,
        metadata: doc.metadata || null
      });
      ids.push(docRef.id);
    });
    yield batch.commit();
    return ids;
  });
  return firestoreIndexer;
};
export {
  getFirestoreDocumentIndexer,
  getFirestoreDocumentRetriever
};
//# sourceMappingURL=firestore.mjs.map